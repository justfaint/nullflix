# Введение в микросервисную архитектуру

*На примере игры про киностудию*

---

## Почему этот цикл

Микросервисная архитектура вызывает много вопросов, связанных как с конкретными инструментами, так и с целостным
пониманием системы. Внутренние сервисы часто воспринимаются как нечто разрозненное, без общего видения, где
заканчивается один компонент и начинается другой.

В рамках цикла разбираются все этапы: от проектирования до сопровождения. Основная цель — понять, когда действительно
стоит использовать микросервисы, с какими проблемами они сопряжены и как их решать правильно.

---

## О чём пойдёт речь

- Что такое микросервисная архитектура, в чём её преимущества и недостатки по сравнению с монолитом и serverless.
- Как грамотно проектировать микросервисы: выделение доменов, взаимодействие, границы ответственности.
- Как работать с инфраструктурой микросервисной системы: развёртывание, тестирование, логирование, мониторинг.
- Какие технологии, подходы и практики используются на реальных проектах.

---

## Пример — Игра про киностудию

В качестве основы используется игра-симулятор, в которой игрок управляет собственной киностудией.

Это экономическая стратегия, в которой пользователь принимает решения по найму персонала, съёмкам фильмов, маркетингу и
получению наград. Пример достаточно комплексный и позволяет проиллюстрировать многие аспекты архитектуры.

---

## Основные элементы игры

- Актёры, режиссёры и сценаристы, каждый с уникальными характеристиками.
- Пул свободных специалистов, доступных для найма.
- Прокат фильмов с кассовыми сборами и статистикой.
- Киностудии игроков и конкурентов.
- Архив фильмов, включая ранее выпущенные.
- Рейтинги студий, актёров и режиссёров.
- Еженедельный Оскар за лучшие фильмы.

---

## Что может делать игрок

- Нанимать, увольнять и управлять зарплатами персонала.
- Назначать сценаристов для создания сценариев.
- Выбирать актёров и режиссёров для съёмок.
- Определять бюджет: сценарий, съёмки, маркетинг.
- Задавать жанр фильма и состав команды в рамках ограничений.

---

## Главная цель игры

Цель игрока — снимать успешные фильмы, поднимать рейтинг своей киностудии и конкурировать с другими за лидерство в
индустрии.

---

## Что такое микросервисная архитектура

Микросервисы — архитектурный стиль, при котором система состоит из набора небольших, независимых компонентов. Каждый из
них реализует свою бизнес-функцию, разрабатывается и развёртывается отдельно.

### Основные характеристики:

1. **Независимость.** Каждый сервис выполняет одну задачу и может работать независимо от остальных.
2. **Изоляция данных.** У каждого сервиса — собственное хранилище, нет общей базы данных.
3. **Коммуникация через API.** Взаимодействие — через REST, gRPC, Kafka и другие механизмы.
4. **Гибкость технологий.** Сервисы могут использовать разные языки и технологии.
5. **Автономия команд.** Команды разрабатывают и сопровождают сервисы независимо друг от друга.

Микросервисная архитектура особенно актуальна в больших, быстроразвивающихся проектах с высокой нагрузкой.

---

## Монолит vs Микросервисы vs Serverless

### Монолит

✅ Прост в разработке и деплое  
✅ Единая кодовая база  
❌ Трудности с масштабированием  
❌ Изменения требуют пересборки всей системы  
❌ Ограничения для параллельной работы команд

### Микросервисы

✅ Независимость команд и компонентов  
✅ Масштабирование на уровне сервисов  
✅ Повышенная отказоустойчивость  
❌ Более сложная инфраструктура  
❌ Необходимость в наблюдаемости и автоматизации

### Serverless

✅ Автоматическое масштабирование  
✅ Оплата за фактическое выполнение  
✅ Отлично подходит для событийных и API-приложений  
❌ Ограничения по времени выполнения  
❌ Привязка к облачным провайдерам

**Выбор подхода:**

- **Монолит** — быстрый старт, прототипирование, MVP
- **Микросервисы** — зрелые, распределённые системы
- **Serverless** — событийная логика, масштабируемые API

---

## Преимущества и недостатки микросервисов

### Преимущества

- **Гибкость разработки.** Команды работают независимо, не мешая друг другу.
- **Масштабируемость.** Масштабируются только те компоненты, которые действительно перегружены.
- **Отказоустойчивость.** Ошибка в одном сервисе не нарушает работу всей системы.
- **Свобода в технологиях.** Возможность выбора языка, базы, библиотеки — для каждого сервиса.
- **Быстрое развертывание.** Не требуется пересборка всей системы при изменении одного компонента.

### Недостатки

- **Сложность во взаимодействии.** Требуется точная настройка маршрутизации, аутентификации и обработки ошибок.
- **Трудности отладки.** Ошибки могут быть распределены по нескольким сервисам и неочевидны.
- **Сетевые накладные расходы.** Задержки на вызов REST/gRPC-запросов между сервисами.
- **Повышенные требования к инфраструктуре.** Необходимость в логировании, мониторинге, оркестрации.
- **Проблемы с транзакциями.** Из-за разделения БД сложно обеспечить атомарность операций.

---

## Примеры применения микросервисов

Микросервисный подход используется в системах, где важны масштабируемость, доступность и гибкость:

- **Банковские системы.** Онлайн-банкинг, кредиты, платёжные шлюзы (Сбер, Тинькофф).
- **Медиа и стриминг.** Обработка видео, рекомендации, персонализация (Netflix, Spotify).
- **E-commerce.** Каталоги, корзина, логистика (Amazon, Ozon).
- **Игры и гейминг.** Мультиплеер, сохранения, облачная логика (Stadia, Xbox Cloud).
- **Доставка и такси.** Оптимизация маршрутов, распределение заказов (Uber, Яндекс Go).
- **SaaS и B2B.** CRM, ERP, системы документооборота (Salesforce, SberCRM).

---

## Когда стоит (и не стоит) использовать микросервисы

| Подходит                               | Не подходит                         |
|----------------------------------------|-------------------------------------|
| Высокая нагрузка и масштабируемость    | Небольшая команда, простой проект   |
| Частые обновления и независимый деплой | Нет DevOps-экспертизы               |
| Сложная бизнес-логика                  | Простая бизнес-логика               |
| Работа с несколькими командами         | Один кросс-функциональный коллектив |
| Необходимость отказоустойчивости       | Проекты без критичных SLA           |

Микросервисы целесообразны в условиях высокой сложности, роста и распределённой разработки. В малых проектах, где важна
скорость и простота, они могут оказаться избыточными.

Следующий шаг: [Разделение сервисов на домены (DDD и границы)](01-ddd-bounded-contexts.md)